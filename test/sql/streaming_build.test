# name: test/sql/streaming_build.test
# description: Test diskann_streaming_build function error handling
# group: [diskann]

require ann

# ========================================
# Non-existent input file
# ========================================

statement error
SELECT * FROM diskann_streaming_build('/tmp/nonexistent_vectors.bin', '__TEST_DIR__/output.diskann');
----
Failed to open input

# ========================================
# Empty file â€” should fail gracefully
# ========================================

# Create an empty file by writing empty content
statement ok
COPY (SELECT '' AS x WHERE false) TO '__TEST_DIR__/empty.bin' (FORMAT CSV, HEADER false);

statement error
SELECT * FROM diskann_streaming_build('__TEST_DIR__/empty.bin', '__TEST_DIR__/output.diskann');
----
Failed to read input header

# ========================================
# Function signature: named parameters exist
# This verifies the function is registered with the right params
# ========================================

statement error
SELECT * FROM diskann_streaming_build('/tmp/nonexistent.bin', '/tmp/out.diskann', metric := 'l2', max_degree := 32, build_complexity := 64, alpha := 1.2, sample_size := 100);
----
Failed to open input
